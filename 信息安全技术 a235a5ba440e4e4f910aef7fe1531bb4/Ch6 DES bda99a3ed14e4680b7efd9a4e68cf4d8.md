# Ch6 DES

# 密码结构

1. DES是分组加密密码，分组大小为64bit，密钥为56bit；
2. DES由两个置换（初始置换和最终置换）以及16个Feistel轮组成，每个轮用由轮密钥生成器生成的不同的48bit的轮密钥。

![DES结构](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled.png)

DES结构

## 初始置换和最终置换

这两层置换都是**直接P盒**，相互可逆，没有加密作用。

## 轮rounds

<aside>
🔥 Explain the components of each round in DES.

</aside>

DES使用16轮（rounds），每一轮都是一个Feistel密码。包含混合器和交换器，这两个加密手段都是可逆的，不可逆元素都存在于**DES函数**中。

![DES轮](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled%201.png)

DES轮

DES函数是DES的核心，它接收右边32bit以及48bit的轮密钥作为输入，生成32bit的输出。函数由四个部分组成：**拓展P盒、XOR、S盒、直接P盒**。

![DES函数](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled%202.png)

DES函数

- 拓展P盒将32bit的输入拓展为48bit的输出。按照4bit进行分组，在每一组的首部增加上一组的末位，尾部增加下一组的首位，第一组和最后一组视为相邻的两组，每组变成了6bit，再合并。
    
    ![DES函数中的拓展P盒](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled%203.png)
    
    DES函数中的拓展P盒
    
- 将得到的48bit与48bit的轮密钥进行XOR操作。
- 使用8个S盒，每一个都是6bit输入和4bit输出。按照6bit进行分组，每组输入一个S盒，用第1、6位确定行号，2、3、4、5位确定列号，通过表格确定S盒的输出。
    
    ![DES函数中的S盒](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled%204.png)
    
    DES函数中的S盒
    
- 通过直接换位盒得到输出。

# 密码和反向密码

如何使密码和反向密码的算法相似？

- 改变最后一轮（第16轮）的算法，只有混合器没有交换器；
- 在最后一轮加上交换器，并且在之后再加入一个交换器，两个交换器可以相互抵消。

轮密钥如何生成？

1. 通过一个压缩P盒去除8bit奇偶校验位，得到56bit密钥；
2. 分成两组，每组28bit；
3. 每组密码左移；
4. 通过压缩P盒生成48bit轮密钥；
5. 重复3-4步骤16次，获取16个轮密钥。

![轮密钥的生成](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled%205.png)

轮密钥的生成

# 密码分析

## 分组密码性质

1. 雪崩效应（Avalanche effect）：明文或密钥中的一个小变化会造成密文的显著改变；
2. 完全效应（Completeness effect）：密文中的每一比特的变化都由明文中很多比特来决定。

## 设计标准

1. 在每一轮到下一轮的加密中，**S盒**提供了比特的扰乱和扩散作用；
2. **P盒**提供了比特的扩散作用；
3. 用了16个Feistel轮，密文完全是一个明文和密文的随机函数。

## 弱点

1. 密码设计中的缺陷：S盒/P盒；
2. 密钥中的缺陷：
    1. 密钥长度：56个比特密钥密码的DES不够安全；
        
        <aside>
        💡 密钥长度是主要的诟病，多重DES可以增加密钥长度。
        
        </aside>
        
    2. 4个弱密钥：去除奇偶位后全0/全1/一半0一半1的密钥，弱密钥是自身的逆；
    3. 6个半弱密钥对，每一对互逆；
    4. 密钥串：两个以上的密钥可以将相同的明文加密成相同的密文。

# 多重DES

## 双重DES

<aside>
🔥 Double DES and Meet-in-the Middle Attack.

</aside>

双重DES用两个DES密码加密，用两个DES反向密码进行解密，使用两个不同的密钥，相当于密码增加了一倍（112）。如图，用k1和k2对明文P加密，用k2和k1对密文C解密。

![Untitled](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled%206.png)

但是，一种名为**中间相遇攻击**的已知明文攻击证明，这种提升并不大。问题在中间文本M，它是由第一次加密和第一次解密创建的，在加密解密后应该是一样的：$M=E_{k_1}(P)=D_{k_2}(C)$。假设攻击者知道一对P和C，首先，可以用所有可能的k1加密P，记录下所有得到的值；其次用多有可能的k2解密C，记录下所有得到的值。可以根据计算出来的M值创建两个表，然后对比M值，找出M值相同的k1和k2对。

如果k1和k2只有一对匹配，就找到了两个密钥（k1,k2)，如果有多于一对密钥，可以截取另一个明/密文对，用候选密钥对来看是否能由明文得到密文，如此重复知道只剩一个密钥对。

这表明攻击者不需要使用$2^{112}$长度的密钥，只要用$2^{56}$的密钥搜索两次，所以，双重DES只是将密钥的长度增加到$2^{57}$而不是$2^{112}$。

## 三重DES

- 两个密钥的三重DES
- 三个密钥的三重DES

![Untitled](Ch6%20DES%20bda99a3ed14e4680b7efd9a4e68cf4d8/Untitled%207.png)

# 密码的安全性

## 暴力攻击

密钥的长度是DES的一个主要缺点，容易受到暴力攻击。但是多重DES可以使DES抵抗暴力攻击。

## 差分密码分析

设计了S盒和16轮Feistel密码，使得DES可以抵抗差分攻击。

## 线性密码分析

与差分密码分析相比，DES更容易受到线性密码分析的攻击。用$2^{43}$对已知明文对就可以破解DES，在实际情况下找到这么多明文是不可能的。